# Do not modify '/var/ipcop/proxy/squid.conf' directly since any changes
# you make will be overwritten whenever you resave proxy settings using the
# web interface!
#
# Instead, modify the file '/var/ipcop/proxy/acls/include.acl' and
# then restart the proxy service using the web interface. Changes made to the
# 'include.acl' file will propagate to the 'squid.conf' file at that time.

shutdown_lifetime 5 seconds
icp_port 0

http_port 127.0.0.1:82


cache_effective_user squid
cache_effective_group squid
umask 022

pid_filename /var/run/squid.pid

cache_mem 2 MB
cache_dir aufs /var/log/cache 50 16 256

error_directory /usr/share/squid/errors/en

access_log stdio:/dev/null
cache_log /dev/null
cache_store_log none

log_mime_hdrs off
logfile_rotate 0
forwarded_for off
via off

acl within_timeframe time MTWHFAS 00:00-24:00

acl manager url_regex -i ^cache_object:// /squid-internal-mgr/
acl localhost src 127.0.0.1/32
acl SSL_ports port 443 # https
acl SSL_ports port 8443 # alternative https
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 1025-65535 # unprivileged ports
acl Safe_ports port 8080 # Squids port (for icons)

acl IPCop_http  port 81
acl IPCop_https port 8443
acl IPCop_ips              dst 192.168.10.254
acl IPCop_networks         src "/var/ipcop/proxy/acls/src_networks.acl"
acl IPCop_servers          dst "/var/ipcop/proxy/acls/src_subnets.acl"
acl IPCop_green_network    src 192.168.10.0/24
acl IPCop_green_servers    dst 192.168.10.0/24
acl IPCop_blue_network     src 192.168.30.0/24
acl IPCop_blue_servers     dst 192.168.30.0/24
acl CONNECT method CONNECT

#Access to squid manager from localhost:
http_access allow         localhost manager  
http_access deny          manager
#local machine, no restriction
http_access allow         localhost

#GUI admin if local machine connects
http_access allow         IPCop_ips IPCop_networks IPCop_http
http_access allow CONNECT IPCop_ips IPCop_networks IPCop_https

#Deny not web services
http_access deny          !Safe_ports
http_access deny  CONNECT !SSL_ports

#Set custom configured ACLs
http_access allow IPCop_networks within_timeframe
http_access deny  all

#Strip HTTP Header
request_header_access X-Forwarded-For deny all
request_header_access Via deny all

maximum_object_size 4096 KB
minimum_object_size 0 KB

request_body_max_size 4096 KB
reply_body_max_size none all

visible_hostname ipcop

cache_mgr admin@localhost

